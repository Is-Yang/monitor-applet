"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,u){try{var i=t[o](u),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateUser=exports.userLogout=exports.getUserInfo=exports.wechatByPhone=exports.decryptPhone=exports.wechatLogin=exports.getOpenid=exports.smsLogin=exports.getCode=void 0;var _wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_wepyRedux=require("./../npm/wepy-redux/lib/index.js"),_tip=require("./../utils/tip.js"),_tip2=_interopRequireDefault(_tip),_qs=require("./../npm/qs/lib/index.js"),_qs2=_interopRequireDefault(_qs),wxRequest=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,o,u,i,s,a,p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g&&_tip2.default.loading(),t={},t["content-type"]="PUT"==d?"application/json":"application/x-www-form-urlencoded",r=(0,_wepyRedux.getStore)(),n=r.getState().user.globalData,o=wx.getStorageSync("token"),o&&(t.Authorization=o),u="test","prod"==u?c="https://tcb-api.tencentcloudapi.com"+c:"test"==u&&(c="https://beidou.signalfire.net.cn/"+c),i="POST"==d?_qs2.default.stringify(p):p,e.next=12,_wepy2.default.request({header:t,url:c,method:d,data:i}).catch(function(e){console.log("wepy requerst err:"+e)});case 12:if(s=e.sent,g&&_tip2.default.loaded(),!s||!s.data){e.next=19;break}return a=s.data,401==a.code&&wx.navigateTo({url:"/pages/login"}),500==a.code&&a.msg&&wx.showToast({title:a.msg,icon:"none",duration:1500}),e.abrupt("return",s.data);case 19:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),getCode=exports.getCode=function(e){return wxRequest(e,"smscode","GET")},smsLogin=exports.smsLogin=function(e){return wxRequest(e,"smslogin")},getOpenid=exports.getOpenid=function(e){return wxRequest(e,"getOpenid")},wechatLogin=exports.wechatLogin=function(e){return wxRequest(e,"wechatlogin")},decryptPhone=exports.decryptPhone=function(e){return wxRequest(e,"decryptWeChatPhoneNumber")},wechatByPhone=exports.wechatByPhone=function(e){return wxRequest(e,"wetChatLoginByPhoneNumber")},getUserInfo=exports.getUserInfo=function(){return wxRequest({},"getInfo","GET")},userLogout=exports.userLogout=function(){return wxRequest({},"logout")},updateUser=exports.updateUser=function(e){return wxRequest(e,"system/user/profile","PUT")};