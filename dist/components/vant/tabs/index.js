"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("./../common/component.js"),touch_1=require("./../mixins/touch.js"),utils_1=require("./../common/utils.js");component_1.VantComponent({mixins:[touch_1.touch],classes:["nav-class","tab-class","tab-active-class","line-class"],relation:{name:"tab",type:"descendant",current:"tabs",linked:function(t){t.index=this.children.length-1,this.updateTabs()},unlinked:function(){this.children=this.children.map(function(t,e){return t.index=e,t}),this.updateTabs()}},props:{color:{type:String,observer:"setLine"},sticky:Boolean,animated:{type:Boolean,observer:function(){var t=this;this.children.forEach(function(e,n){return e.updateRender(n===t.data.currentIndex,t)})}},swipeable:Boolean,lineWidth:{type:[String,Number],value:-1,observer:"setLine"},lineHeight:{type:[String,Number],value:-1,observer:"setLine"},titleActiveColor:String,titleInactiveColor:String,active:{type:[String,Number],value:0,observer:function(t){t!==this.getCurrentName()&&this.setCurrentIndexByName(t)}},type:{type:String,value:"line"},border:{type:Boolean,value:!0},ellipsis:{type:Boolean,value:!0},duration:{type:Number,value:.3},zIndex:{type:Number,value:1},swipeThreshold:{type:Number,value:4,observer:function(t){this.setData({scrollable:this.children.length>t||!this.data.ellipsis})}},offsetTop:{type:Number,value:0},lazyRender:{type:Boolean,value:!0}},data:{tabs:[],lineStyle:"",scrollLeft:0,scrollable:!1,trackStyle:"",currentIndex:null,container:null},mounted:function(){var t=this;wx.nextTick(function(){t.setLine(!0),t.scrollIntoView()})},methods:{updateContainer:function(){var t=this;this.setData({container:function(){return t.createSelectorQuery().select(".van-tabs")}})},updateTabs:function(){var t=this,e=t.children,n=void 0===e?[]:e,i=t.data;this.setData({tabs:n.map(function(t){return t.data}),scrollable:this.children.length>i.swipeThreshold||!i.ellipsis}),this.setCurrentIndexByName(this.getCurrentName()||i.active)},trigger:function(t,e){var n=this.data.currentIndex,i=e||this.children[n];utils_1.isDef(i)&&this.$emit(t,{index:i.index,name:i.getComputedName(),title:i.data.title})},onTap:function(t){var e=this,n=t.currentTarget.dataset.index,i=this.children[n];i.data.disabled?this.trigger("disabled",i):(this.setCurrentIndex(n),wx.nextTick(function(){e.trigger("click")}))},setCurrentIndexByName:function(t){var e=this.children,n=void 0===e?[]:e,i=n.filter(function(e){return e.getComputedName()===t});i.length&&this.setCurrentIndex(i[0].index)},setCurrentIndex:function(t){var e=this,n=this,i=n.data,r=n.children,a=void 0===r?[]:r;if(!(!utils_1.isDef(t)||t>=a.length||t<0)&&(a.forEach(function(n,i){var r=i===t;r===n.data.active&&n.inited||n.updateRender(r,e)}),t!==i.currentIndex)){var s=null!==i.currentIndex;this.setData({currentIndex:t}),wx.nextTick(function(){e.setLine(),e.scrollIntoView(),e.updateContainer(),e.trigger("input"),s&&e.trigger("change")})}},getCurrentName:function(){var t=this.children[this.data.currentIndex];if(t)return t.getComputedName()},setLine:function(t){var e=this;if("line"===this.data.type){var n=this.data,i=n.color,r=n.duration,a=n.currentIndex,s=n.lineWidth,o=n.lineHeight;this.getRect(".van-tab",!0).then(function(n){void 0===n&&(n=[]);var l=n[a];if(null!=l){var u=-1!==s?s:l.width/2,c=-1!==o?"height: "+utils_1.addUnit(o)+"; border-radius: "+utils_1.addUnit(o)+";":"",d=n.slice(0,a).reduce(function(t,e){return t+e.width},0);d+=(l.width-u)/2;var h=t?"":"transition-duration: "+r+"s; -webkit-transition-duration: "+r+"s;";e.setData({lineStyle:"\n            "+c+"\n            width: "+utils_1.addUnit(u)+";\n            background-color: "+i+";\n            -webkit-transform: translateX("+d+"px);\n            transform: translateX("+d+"px);\n            "+h+"\n          "})}})}},scrollIntoView:function(){var t=this,e=this.data,n=e.currentIndex;e.scrollable&&Promise.all([this.getRect(".van-tab",!0),this.getRect(".van-tabs__nav")]).then(function(e){var i=e[0],r=e[1],a=i[n],s=i.slice(0,n).reduce(function(t,e){return t+e.width},0);t.setData({scrollLeft:s-(r.width-a.width)/2})})},onTouchScroll:function(t){this.$emit("scroll",t.detail)},onTouchStart:function(t){this.data.swipeable&&this.touchStart(t)},onTouchMove:function(t){this.data.swipeable&&this.touchMove(t)},onTouchEnd:function(){if(this.data.swipeable){var t=this.data,e=t.tabs,n=t.currentIndex,i=this,r=i.direction,a=i.deltaX,s=i.offsetX;"horizontal"===r&&s>=50&&(a>0&&0!==n?this.setCurrentIndex(n-1):a<0&&n!==e.length-1&&this.setCurrentIndex(n+1))}}}});