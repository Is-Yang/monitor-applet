"use strict";var __assign=function(){return __assign=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++){t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},__assign.apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("./../common/component.js"),utils_1=require("./utils.js");component_1.VantComponent({props:{disabled:Boolean,multiple:Boolean,uploadText:String,useBeforeRead:Boolean,previewSize:{type:null,value:90},name:{type:[Number,String],value:""},accept:{type:String,value:"image"},sizeType:{type:Array,value:["original","compressed"]},capture:{type:Array,value:["album","camera"]},fileList:{type:Array,value:[],observer:"formatFileList"},maxSize:{type:Number,value:Number.MAX_VALUE},maxCount:{type:Number,value:100},deletable:{type:Boolean,value:!0},previewImage:{type:Boolean,value:!0},previewFullImage:{type:Boolean,value:!0},imageFit:{type:String,value:"scaleToFill"},camera:{type:String,value:"back"},compressed:{type:Boolean,value:!0},maxDuration:{type:Number,value:60}},data:{lists:[],computedPreviewSize:"",isInCount:!0},methods:{formatFileList:function(){var e=this.data,t=e.fileList,a=void 0===t?[]:t,i=e.maxCount,n=a.map(function(e){return __assign(__assign({},e),{isImage:void 0===e.isImage?utils_1.isImageFile(e):e.isImage})});this.setData({lists:n,isInCount:n.length<i})},startUpload:function(){var e=this;if(!this.data.disabled){var t=this.data,a=t.name,i=void 0===a?"":a,n=t.capture,r=t.maxCount,s=t.multiple,o=t.maxSize,l=t.accept,u=t.sizeType,m=t.lists,c=t.camera,p=t.compressed,v=t.maxDuration,d=t.useBeforeRead,f=void 0!==d&&d,g=null,y=r-m.length;g="image"===l?new Promise(function(e,t){wx.chooseImage({count:s?y>9?9:y:1,sourceType:n,sizeType:u,success:e,fail:t})}):"video"===l?new Promise(function(e,t){wx.chooseVideo({sourceType:n,compressed:p,maxDuration:v,camera:c,success:e,fail:t})}):new Promise(function(e,t){wx.chooseMessageFile({count:s?y:1,type:"file",success:e,fail:t})}),g.then(function(t){var a=null;if((a=utils_1.isVideo(t,l)?__assign({path:t.tempFilePath},t):s?t.tempFiles:t.tempFiles[0])instanceof Array){if(!a.every(function(e){return e.size<=o}))return void e.$emit("oversize",{name:i})}else if(a.size>o)return void e.$emit("oversize",{name:i});f?e.$emit("before-read",{file:a,name:i,callback:function(t){t&&e.$emit("after-read",{file:a,name:i})}}):e.$emit("after-read",{file:a,name:i})}).catch(function(t){e.$emit("error",t)})}},deleteItem:function(e){var t=e.currentTarget.dataset.index;this.$emit("delete",{index:t,name:this.data.name})},doPreviewImage:function(e){if(this.data.previewFullImage){var t=e.currentTarget.dataset.url,a=this.data.lists.filter(function(e){return e.isImage}).map(function(e){return e.url||e.path});this.$emit("click-preview",{url:t,name:this.data.name}),wx.previewImage({urls:a,current:t,fail:function(){wx.showToast({title:"预览图片失败",icon:"none"})}})}}}});